{"version":3,"file":"common.js","sourceRoot":"","sources":["../../../../lib/modules/datasource/helm/common.ts"],"names":[],"mappings":";;;AAAA,iDAAsD;AACtD,+CAAoD;AACpD,+CAA4C;AAG5C,MAAM,SAAS,GAAG,IAAA,aAAK,EAAC,2BAA2B,CAAC,CAAC;AACrD,MAAM,aAAa,GAAG,IAAA,aAAK,EACzB,oDAAoD,CACrD,CAAC;AAEF,SAAS,mBAAmB,CAAC,GAAW;IACtC,IAAI,IAAA,uBAAc,EAAC,GAAG,CAAC,KAAK,IAAI,EAAE;QAChC,OAAO,KAAK,CAAC;KACd;IAED,MAAM,MAAM,GAAG,IAAA,iBAAW,EAAC,GAAG,CAAC,CAAC;IAChC,OAAO,SAAS,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;AACrC,CAAC;AAED,SAAgB,aAAa,CAAC,OAAoB;IAChD,2BAA2B;IAC3B,MAAM,YAAY,GAAG,aAAa,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;IACzD,IAAI,YAAY,EAAE;QAChB,OAAO,YAAY,CAAC,CAAC,CAAC,CAAC;KACxB;IAED,IAAI,OAAO,CAAC,IAAI,IAAI,mBAAmB,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE;QACrD,OAAO,OAAO,CAAC,IAAI,CAAC;KACrB;IAED,IAAI,CAAC,OAAO,CAAC,OAAO,EAAE,MAAM,EAAE;QAC5B,OAAO,IAAI,CAAC;KACb;IAED,KAAK,MAAM,GAAG,IAAI,OAAO,CAAC,OAAO,EAAE;QACjC,IAAI,mBAAmB,CAAC,GAAG,CAAC,EAAE;YAC5B,OAAO,GAAG,CAAC;SACZ;KACF;IAED,WAAW;IACX,OAAO,OAAO,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;AAC5B,CAAC;AAvBD,sCAuBC","sourcesContent":["import { detectPlatform } from '../../../util/common';\nimport { parseGitUrl } from '../../../util/git/url';\nimport { regEx } from '../../../util/regex';\nimport type { HelmRelease } from './types';\n\nconst chartRepo = regEx(/charts?|helm|helm-charts/i);\nconst githubRelease = regEx(\n  /^(https:\\/\\/github\\.com\\/[^/]+\\/[^/]+)\\/releases\\//\n);\n\nfunction isPossibleChartRepo(url: string): boolean {\n  if (detectPlatform(url) === null) {\n    return false;\n  }\n\n  const parsed = parseGitUrl(url);\n  return chartRepo.test(parsed.name);\n}\n\nexport function findSourceUrl(release: HelmRelease): string | null {\n  // it's a github release :)\n  const releaseMatch = githubRelease.exec(release.urls[0]);\n  if (releaseMatch) {\n    return releaseMatch[1];\n  }\n\n  if (release.home && isPossibleChartRepo(release.home)) {\n    return release.home;\n  }\n\n  if (!release.sources?.length) {\n    return null;\n  }\n\n  for (const url of release.sources) {\n    if (isPossibleChartRepo(url)) {\n      return url;\n    }\n  }\n\n  // fallback\n  return release.sources[0];\n}\n"]}