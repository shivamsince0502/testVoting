{"version":3,"file":"schema.js","sourceRoot":"","sources":["../../../lib/modules/versioning/schema.ts"],"names":[],"mappings":";;;;AAAA,kEAAkC;AAClC,6BAAwB;AACxB,yCAAsC;AACtC,wDAAgC;AAChC,4EAAsD;AAGzC,QAAA,UAAU,GAAG,OAAC;KACxB,MAAM,EAAE;KACR,SAAS,CAAC,CAAC,cAAc,EAAE,GAAG,EAAiB,EAAE;IAChD,MAAM,CAAC,cAAc,EAAE,GAAG,cAAc,CAAC,GAAG,cAAc,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;IAEtE,IAAI,UAAU,GAAG,aAAW,CAAC,GAAG,CAAC,cAAc,CAAC,CAAC;IACjD,IAAI,CAAC,UAAU,EAAE;QACf,eAAM,CAAC,IAAI,CACT,EAAE,UAAU,EAAE,cAAc,EAAE,EAC9B,gBAAgB,cAAc,gCAAgC,iBAAiB,CAAC,EAAE,EAAE,CACrF,CAAC;QACF,OAAO,iBAAiB,CAAC,GAAG,CAAC;KAC9B;IAED,IAAI,YAAE,CAAC,SAAS,CAAC,UAAU,CAAC,EAAE;QAC5B,MAAM,gBAAgB,GAAG,cAAc,CAAC,MAAM;YAC5C,CAAC,CAAC,cAAc,CAAC,IAAI,CAAC,GAAG,CAAC;YAC1B,CAAC,CAAC,SAAS,CAAC;QAEd,IAAI;YACF,UAAU,GAAG,IAAI,UAAU,CAAC,gBAAgB,CAAC,CAAC;SAC/C;QAAC,OAAO,KAAK,EAAE;YACd,GAAG,CAAC,QAAQ,CAAC;gBACX,IAAI,EAAE,QAAQ;gBACd,OAAO,EAAE,gBAAgB,cAAc,wBAAwB;gBAC/D,MAAM,EAAE,EAAE,KAAK,EAAE;aAClB,CAAC,CAAC;YACH,OAAO,OAAC,CAAC,KAAK,CAAC;SAChB;KACF;IAED,OAAO,UAAU,CAAC;AACpB,CAAC,CAAC,CAAC","sourcesContent":["import is from '@sindresorhus/is';\nimport { z } from 'zod';\nimport { logger } from '../../logger';\nimport versionings from './api';\nimport * as defaultVersioning from './semver-coerced';\nimport type { VersioningApi } from './types';\n\nexport const Versioning = z\n  .string()\n  .transform((versioningSpec, ctx): VersioningApi => {\n    const [versioningName, ...versioningRest] = versioningSpec.split(':');\n\n    let versioning = versionings.get(versioningName);\n    if (!versioning) {\n      logger.info(\n        { versioning: versioningSpec },\n        `Versioning: '${versioningSpec}' not found, falling back to ${defaultVersioning.id}`\n      );\n      return defaultVersioning.api;\n    }\n\n    if (is.function_(versioning)) {\n      const versioningConfig = versioningRest.length\n        ? versioningRest.join(':')\n        : undefined;\n\n      try {\n        versioning = new versioning(versioningConfig);\n      } catch (error) {\n        ctx.addIssue({\n          code: 'custom',\n          message: `Versioning: '${versioningSpec}' failed to initialize`,\n          params: { error },\n        });\n        return z.NEVER;\n      }\n    }\n\n    return versioning;\n  });\n"]}