{"version":3,"file":"github.js","sourceRoot":"","sources":["../../../lib/util/http/github.ts"],"names":[],"mappings":"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","sourcesContent":["import is from '@sindresorhus/is';\nimport { DateTime } from 'luxon';\nimport {\n  PLATFORM_BAD_CREDENTIALS,\n  PLATFORM_INTEGRATION_UNAUTHORIZED,\n  PLATFORM_RATE_LIMIT_EXCEEDED,\n  REPOSITORY_CHANGED,\n} from '../../constants/error-messages';\nimport { logger } from '../../logger';\nimport { ExternalHostError } from '../../types/errors/external-host-error';\nimport { getCache } from '../cache/repository';\nimport { maskToken } from '../mask';\nimport * as p from '../promises';\nimport { range } from '../range';\nimport { regEx } from '../regex';\nimport { joinUrlParts, parseLinkHeader, resolveBaseUrl } from '../url';\nimport { findMatchingRules } from './host-rules';\nimport type { GotLegacyError } from './legacy';\nimport type {\n  GraphqlOptions,\n  HttpOptions,\n  HttpRequestOptions,\n  HttpResponse,\n  InternalHttpOptions,\n} from './types';\nimport { Http } from '.';\n\nconst githubBaseUrl = 'https://api.github.com/';\nlet baseUrl = githubBaseUrl;\nexport const setBaseUrl = (url: string): void => {\n  baseUrl = url;\n};\n\nexport interface GithubHttpOptions extends HttpOptions {\n  paginate?: boolean | string;\n  paginationField?: string;\n  pageLimit?: number;\n  repository?: string;\n}\n\ninterface GithubGraphqlRepoData<T = unknown> {\n  repository?: T;\n}\n\nexport type GithubGraphqlResponse<T = unknown> =\n  | {\n      data: T;\n      errors?: never;\n    }\n  | {\n      data?: never;\n      errors: {\n        type?: string;\n        message: string;\n      }[];\n    };\n\nfunction handleGotError(\n  err: GotLegacyError,\n  url: string | URL,\n  opts: GithubHttpOptions\n): Error {\n  const path = url.toString();\n  let message = err.message || '';\n  const body = err.response?.body;\n  if (is.plainObject(body) && 'message' in body) {\n    message = String(body.message);\n  }\n  if (\n    err.code === 'ERR_HTTP2_STREAM_ERROR' ||\n    err.code === 'ENOTFOUND' ||\n    err.code === 'ETIMEDOUT' ||\n    err.code === 'EAI_AGAIN' ||\n    err.code === 'ECONNRESET'\n  ) {\n    logger.debug({ err }, 'GitHub failure: RequestError');\n    return new ExternalHostError(err, 'github');\n  }\n  if (err.name === 'ParseError') {\n    logger.debug({ err }, '');\n    return new ExternalHostError(err, 'github');\n  }\n  if (err.statusCode && err.statusCode >= 500 && err.statusCode < 600) {\n    logger.debug({ err }, 'GitHub failure: 5xx');\n    return new ExternalHostError(err, 'github');\n  }\n  if (\n    err.statusCode === 403 &&\n    message.startsWith('You have triggered an abuse detection mechanism')\n  ) {\n    logger.debug({ err }, 'GitHub failure: abuse detection');\n    return new Error(PLATFORM_RATE_LIMIT_EXCEEDED);\n  }\n  if (\n    err.statusCode === 403 &&\n    message.startsWith('You have exceeded a secondary rate limit')\n  ) {\n    logger.warn({ err }, 'GitHub failure: secondary rate limit');\n    return new Error(PLATFORM_RATE_LIMIT_EXCEEDED);\n  }\n  if (err.statusCode === 403 && message.includes('Upgrade to GitHub Pro')) {\n    logger.debug(`Endpoint: ${path}, needs paid GitHub plan`);\n    return err;\n  }\n  if (err.statusCode === 403 && message.includes('rate limit exceeded')) {\n    logger.debug({ err }, 'GitHub failure: rate limit');\n    return new Error(PLATFORM_RATE_LIMIT_EXCEEDED);\n  }\n  if (\n    err.statusCode === 403 &&\n    message.startsWith('Resource not accessible by integration')\n  ) {\n    logger.debug(\n      { err },\n      'GitHub failure: Resource not accessible by integration'\n    );\n    return new Error(PLATFORM_INTEGRATION_UNAUTHORIZED);\n  }\n  if (err.statusCode === 401 && message.includes('Bad credentials')) {\n    const rateLimit = err.headers?.['x-ratelimit-limit'] ?? -1;\n    logger.debug(\n      {\n        token: maskToken(opts.token),\n        err,\n      },\n      'GitHub failure: Bad credentials'\n    );\n    if (rateLimit === '60') {\n      return new ExternalHostError(err, 'github');\n    }\n    return new Error(PLATFORM_BAD_CREDENTIALS);\n  }\n  if (err.statusCode === 422) {\n    if (\n      message.includes('Review cannot be requested from pull request author')\n    ) {\n      return err;\n    } else if (err.body?.errors?.find((e: any) => e.code === 'invalid')) {\n      logger.debug({ err }, 'Received invalid response - aborting');\n      return new Error(REPOSITORY_CHANGED);\n    } else if (\n      err.body?.errors?.find((e: any) =>\n        e.message?.startsWith('A pull request already exists')\n      )\n    ) {\n      return err;\n    }\n    logger.debug({ err }, '422 Error thrown from GitHub');\n    return new ExternalHostError(err, 'github');\n  }\n  if (\n    err.statusCode === 410 &&\n    err.body?.message === 'Issues are disabled for this repo'\n  ) {\n    return err;\n  }\n  return err;\n}\n\ninterface GraphqlPaginatedContent<T = unknown> {\n  nodes: T[];\n  edges: T[];\n  pageInfo: { hasNextPage: boolean; endCursor: string };\n}\n\nfunction constructAcceptString(input?: any): string {\n  const defaultAccept = 'application/vnd.github.v3+json';\n  const acceptStrings =\n    typeof input === 'string' ? input.split(regEx(/\\s*,\\s*/)) : [];\n\n  // TODO: regression of #6736\n  if (\n    !acceptStrings.some((x) => x === defaultAccept) &&\n    (!acceptStrings.some((x) => x.startsWith('application/vnd.github.')) ||\n      acceptStrings.length < 2)\n  ) {\n    acceptStrings.push(defaultAccept);\n  }\n  return acceptStrings.join(', ');\n}\n\nconst MAX_GRAPHQL_PAGE_SIZE = 100;\n\ninterface GraphqlPageCacheItem {\n  pageLastResizedAt: string;\n  pageSize: number;\n}\n\nexport type GraphqlPageCache = Record<string, GraphqlPageCacheItem>;\n\nfunction getGraphqlPageSize(\n  fieldName: string,\n  defaultPageSize = MAX_GRAPHQL_PAGE_SIZE\n): number {\n  const cache = getCache();\n  const graphqlPageCache = cache?.platform?.github\n    ?.graphqlPageCache as GraphqlPageCache;\n  const cachedRecord = graphqlPageCache?.[fieldName];\n\n  if (graphqlPageCache && cachedRecord) {\n    logger.debug(\n      { fieldName, ...cachedRecord },\n      'GraphQL page size: found cached value'\n    );\n\n    const oldPageSize = cachedRecord.pageSize;\n\n    const now = DateTime.local();\n    const then = DateTime.fromISO(cachedRecord.pageLastResizedAt);\n    const expiry = then.plus({ hours: 24 });\n    if (now > expiry) {\n      const newPageSize = Math.min(oldPageSize * 2, MAX_GRAPHQL_PAGE_SIZE);\n      if (newPageSize < MAX_GRAPHQL_PAGE_SIZE) {\n        const timestamp = now.toISO()!;\n\n        logger.debug(\n          { fieldName, oldPageSize, newPageSize, timestamp },\n          'GraphQL page size: expanding'\n        );\n\n        cachedRecord.pageLastResizedAt = timestamp;\n        cachedRecord.pageSize = newPageSize;\n      } else {\n        logger.debug(\n          { fieldName, oldPageSize, newPageSize },\n          'GraphQL page size: expanded to default page size'\n        );\n\n        delete graphqlPageCache[fieldName];\n      }\n\n      return newPageSize;\n    }\n\n    return oldPageSize;\n  }\n\n  return defaultPageSize;\n}\n\nfunction setGraphqlPageSize(fieldName: string, newPageSize: number): void {\n  const oldPageSize = getGraphqlPageSize(fieldName);\n  if (newPageSize !== oldPageSize) {\n    const now = DateTime.local();\n    const pageLastResizedAt = now.toISO()!;\n    logger.debug(\n      { fieldName, oldPageSize, newPageSize, timestamp: pageLastResizedAt },\n      'GraphQL page size: shrinking'\n    );\n    const cache = getCache();\n    cache.platform ??= {};\n    cache.platform.github ??= {};\n    cache.platform.github.graphqlPageCache ??= {};\n    const graphqlPageCache = cache.platform.github\n      .graphqlPageCache as GraphqlPageCache;\n    graphqlPageCache[fieldName] = {\n      pageLastResizedAt,\n      pageSize: newPageSize,\n    };\n  }\n}\n\nfunction replaceUrlBase(url: URL, baseUrl: string): URL {\n  const relativeUrl = `${url.pathname}${url.search}`;\n  return new URL(relativeUrl, baseUrl);\n}\n\nexport class GithubHttp extends Http<GithubHttpOptions> {\n  constructor(hostType = 'github', options?: GithubHttpOptions) {\n    super(hostType, options);\n  }\n\n  protected override async request<T>(\n    url: string | URL,\n    options?: InternalHttpOptions & GithubHttpOptions & HttpRequestOptions<T>,\n    okToRetry = true\n  ): Promise<HttpResponse<T>> {\n    const opts: GithubHttpOptions = {\n      baseUrl,\n      ...options,\n      throwHttpErrors: true,\n    };\n\n    if (!opts.token) {\n      const authUrl = new URL(resolveBaseUrl(opts.baseUrl!, url));\n\n      if (opts.repository) {\n        // set authUrl to https://api.github.com/repos/org/repo or https://gihub.domain.com/api/v3/repos/org/repo\n        authUrl.hash = '';\n        authUrl.search = '';\n        authUrl.pathname = joinUrlParts(\n          authUrl.pathname.startsWith('/api/v3') ? '/api/v3' : '',\n          'repos',\n          `${opts.repository}`\n        );\n      }\n\n      const { token } = findMatchingRules(\n        { hostType: this.hostType },\n        authUrl.toString()\n      );\n      opts.token = token;\n    }\n\n    const accept = constructAcceptString(opts.headers?.accept);\n\n    opts.headers = {\n      ...opts.headers,\n      accept,\n    };\n\n    try {\n      const result = await super.request<T>(url, opts);\n      if (opts.paginate) {\n        // Check if result is paginated\n        const pageLimit = opts.pageLimit ?? 10;\n        const linkHeader = parseLinkHeader(result?.headers?.link);\n        const next = linkHeader?.next;\n        if (next?.url && linkHeader?.last?.page) {\n          let lastPage = parseInt(linkHeader.last.page, 10);\n          // istanbul ignore else: needs a test\n          if (!process.env.RENOVATE_PAGINATE_ALL && opts.paginate !== 'all') {\n            lastPage = Math.min(pageLimit, lastPage);\n          }\n          const baseUrl = opts.baseUrl;\n          const parsedUrl = new URL(next.url, baseUrl);\n          const rebasePagination =\n            !!baseUrl &&\n            !!process.env.RENOVATE_X_REBASE_PAGINATION_LINKS &&\n            // Preserve github.com URLs for use cases like release notes\n            parsedUrl.origin !== 'https://api.github.com';\n          const firstPageUrl = rebasePagination\n            ? replaceUrlBase(parsedUrl, baseUrl)\n            : parsedUrl;\n          const queue = [...range(2, lastPage)].map(\n            (pageNumber) => (): Promise<HttpResponse<T>> => {\n              // copy before modifying searchParams\n              const nextUrl = new URL(firstPageUrl);\n              nextUrl.searchParams.set('page', String(pageNumber));\n              return this.request<T>(\n                nextUrl,\n                { ...opts, paginate: false },\n                okToRetry\n              );\n            }\n          );\n          const pages = await p.all(queue);\n          if (opts.paginationField && is.plainObject(result.body)) {\n            const paginatedResult = result.body[opts.paginationField];\n            if (is.array<T>(paginatedResult)) {\n              for (const nextPage of pages) {\n                if (is.plainObject(nextPage.body)) {\n                  const nextPageResults = nextPage.body[opts.paginationField];\n                  if (is.array<T>(nextPageResults)) {\n                    paginatedResult.push(...nextPageResults);\n                  }\n                }\n              }\n            }\n          } else if (is.array<T>(result.body)) {\n            for (const nextPage of pages) {\n              if (is.array<T>(nextPage.body)) {\n                result.body.push(...nextPage.body);\n              }\n            }\n          }\n        }\n      }\n      return result;\n    } catch (err) {\n      throw handleGotError(err, url, opts);\n    }\n  }\n\n  public async requestGraphql<T = unknown>(\n    query: string,\n    options: GraphqlOptions = {}\n  ): Promise<GithubGraphqlResponse<T> | null> {\n    const path = 'graphql';\n\n    const { paginate, count = MAX_GRAPHQL_PAGE_SIZE, cursor = null } = options;\n    let { variables } = options;\n    if (paginate) {\n      variables = {\n        ...variables,\n        count,\n        cursor,\n      };\n    }\n    const body = variables ? { query, variables } : { query };\n\n    const opts: GithubHttpOptions = {\n      baseUrl: baseUrl.replace('/v3/', '/'), // GHE uses unversioned graphql path\n      body,\n      headers: { accept: options?.acceptHeader },\n    };\n\n    logger.trace(`Performing Github GraphQL request`);\n\n    try {\n      const res = await this.postJson<GithubGraphqlResponse<T>>(\n        'graphql',\n        opts\n      );\n      return res?.body;\n    } catch (err) {\n      logger.debug({ err, query, options }, 'Unexpected GraphQL Error');\n      if (err instanceof ExternalHostError && count && count > 10) {\n        logger.info('Reducing pagination count to workaround graphql errors');\n        return null;\n      }\n      throw handleGotError(err, path, opts);\n    }\n  }\n\n  async queryRepoField<T = Record<string, unknown>>(\n    query: string,\n    fieldName: string,\n    options: GraphqlOptions = {}\n  ): Promise<T[]> {\n    const result: T[] = [];\n\n    const { paginate = true } = options;\n\n    let optimalCount: null | number = null;\n    let count = getGraphqlPageSize(\n      fieldName,\n      options.count ?? MAX_GRAPHQL_PAGE_SIZE\n    );\n    let limit = options.limit ?? 1000;\n    let cursor: string | null = null;\n\n    let isIterating = true;\n    while (isIterating) {\n      const res = await this.requestGraphql<GithubGraphqlRepoData<T>>(query, {\n        ...options,\n        count: Math.min(count, limit),\n        cursor,\n        paginate,\n      });\n      const repositoryData = res?.data?.repository;\n      if (\n        is.nonEmptyObject(repositoryData) &&\n        !is.nullOrUndefined(repositoryData[fieldName])\n      ) {\n        optimalCount = count;\n\n        const {\n          nodes = [],\n          edges = [],\n          pageInfo,\n        } = repositoryData[fieldName] as GraphqlPaginatedContent<T>;\n        result.push(...nodes);\n        result.push(...edges);\n\n        limit = Math.max(0, limit - nodes.length - edges.length);\n\n        if (limit === 0) {\n          isIterating = false;\n        } else if (paginate && pageInfo) {\n          const { hasNextPage, endCursor } = pageInfo;\n          if (hasNextPage && endCursor) {\n            cursor = endCursor;\n          } else {\n            isIterating = false;\n          }\n        }\n      } else {\n        count = Math.floor(count / 2);\n        if (count === 0) {\n          logger.warn({ query, options, res }, 'Error fetching GraphQL nodes');\n          isIterating = false;\n        }\n      }\n\n      if (!paginate) {\n        isIterating = false;\n      }\n    }\n\n    if (optimalCount && optimalCount < MAX_GRAPHQL_PAGE_SIZE) {\n      setGraphqlPageSize(fieldName, optimalCount);\n    }\n\n    return result;\n  }\n}\n"]}