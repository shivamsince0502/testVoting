{"version":3,"file":"current-version.js","sourceRoot":"","sources":["../../../lib/util/package-rules/current-version.ts"],"names":[],"mappings":";;;;AAAA,kEAAkC;AAElC,yCAAsC;AACtC,gFAA0D;AAC1D,oCAAgD;AAChD,iCAAiC;AAEjC,MAAa,qBAAsB,SAAQ,cAAO;IACvC,OAAO,CACd,EACE,UAAU,EACV,aAAa,EACb,YAAY,EACZ,cAAc,GACS,EACzB,EAAE,mBAAmB,EAAe;QAEpC,IAAI,YAAE,CAAC,SAAS,CAAC,mBAAmB,CAAC,EAAE;YACrC,OAAO,IAAI,CAAC;SACb;QACD,MAAM,oBAAoB,GACxB,CAAC,CAAC,aAAa,IAAI,YAAE,CAAC,eAAe,CAAC,YAAY,CAAC,CAAC;QACtD,MAAM,OAAO,GAAG,aAAa,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;QAC9C,MAAM,sBAAsB,GAAG,mBAAmB,CAAC,QAAQ,EAAE,CAAC;QAC9D,MAAM,uBAAuB,GAAG,IAAA,4BAAoB,EAClD,sBAAsB,CACvB,CAAC;QAEF,IAAI,uBAAuB,EAAE;YAC3B,MAAM,cAAc,GAAG,aAAa,IAAI,cAAc,IAAI,YAAY,CAAC;YACvE,OAAO,CACL,CAAC,YAAE,CAAC,eAAe,CAAC,cAAc,CAAC;gBACnC,uBAAuB,CAAC,cAAc,CAAC,CACxC,CAAC;SACH;QACD,IAAI,OAAO,CAAC,SAAS,CAAC,sBAAsB,CAAC,EAAE;YAC7C,IAAI;gBACF,OAAO,CACL,oBAAoB;oBACpB,CAAC,CAAC,CACA,YAAY;wBACZ,OAAO,CAAC,OAAO,CAAC,YAAY,CAAC;wBAC7B,OAAO,CAAC,OAAO,CAAC,sBAAsB,EAAE,YAAY,CAAC,CACtD,CACF,CAAC;aACH;YAAC,OAAO,GAAG,EAAE;gBACZ,OAAO,KAAK,CAAC;aACd;SACF;QAED,MAAM,cAAc,GAAG,OAAO,CAAC,SAAS,CAAC,YAAY,CAAC;YACpD,CAAC,CAAC,YAAY,CAAC,4CAA4C;YAC3D,CAAC,CAAC,aAAa,IAAI,cAAc,CAAC,CAAC,0DAA0D;QAC/F,IAAI,YAAE,CAAC,eAAe,CAAC,cAAc,CAAC,EAAE;YACtC,OAAO,KAAK,CAAC;SACd;QACD,IAAI,OAAO,CAAC,SAAS,CAAC,cAAc,CAAC,EAAE;YACrC,OAAO,OAAO,CAAC,OAAO,CAAC,cAAc,EAAE,mBAAmB,CAAC,CAAC;SAC7D;QACD,eAAM,CAAC,KAAK,CACV,EAAE,sBAAsB,EAAE,YAAY,EAAE,EACxC,qCAAqC,CACtC,CAAC;QACF,OAAO,KAAK,CAAC;IACf,CAAC;CACF;AA1DD,sDA0DC","sourcesContent":["import is from '@sindresorhus/is';\nimport type { PackageRule, PackageRuleInputConfig } from '../../config/types';\nimport { logger } from '../../logger';\nimport * as allVersioning from '../../modules/versioning';\nimport { configRegexPredicate } from '../regex';\nimport { Matcher } from './base';\n\nexport class CurrentVersionMatcher extends Matcher {\n  override matches(\n    {\n      versioning,\n      lockedVersion,\n      currentValue,\n      currentVersion,\n    }: PackageRuleInputConfig,\n    { matchCurrentVersion }: PackageRule\n  ): boolean | null {\n    if (is.undefined(matchCurrentVersion)) {\n      return null;\n    }\n    const isUnconstrainedValue =\n      !!lockedVersion && is.nullOrUndefined(currentValue);\n    const version = allVersioning.get(versioning);\n    const matchCurrentVersionStr = matchCurrentVersion.toString();\n    const matchCurrentVersionPred = configRegexPredicate(\n      matchCurrentVersionStr\n    );\n\n    if (matchCurrentVersionPred) {\n      const compareVersion = lockedVersion ?? currentVersion ?? currentValue;\n      return (\n        !is.nullOrUndefined(compareVersion) &&\n        matchCurrentVersionPred(compareVersion)\n      );\n    }\n    if (version.isVersion(matchCurrentVersionStr)) {\n      try {\n        return (\n          isUnconstrainedValue ||\n          !!(\n            currentValue &&\n            version.isValid(currentValue) &&\n            version.matches(matchCurrentVersionStr, currentValue)\n          )\n        );\n      } catch (err) {\n        return false;\n      }\n    }\n\n    const compareVersion = version.isVersion(currentValue)\n      ? currentValue // it's a version so we can match against it\n      : lockedVersion ?? currentVersion; // need to match against this currentVersion, if available\n    if (is.nullOrUndefined(compareVersion)) {\n      return false;\n    }\n    if (version.isVersion(compareVersion)) {\n      return version.matches(compareVersion, matchCurrentVersion);\n    }\n    logger.debug(\n      { matchCurrentVersionStr, currentValue },\n      'Could not find a version to compare'\n    );\n    return false;\n  }\n}\n"]}